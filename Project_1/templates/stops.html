<!DOCTYPE html>
<html lang="en">
<head>
  <title>TheBus: Closest Bus Stops</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Shadows Into Light">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/static/styles.css">
<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fffef2;
      color: #333;
    }

    h1 {
      color: #ffcc00;
      border-bottom: 4px solid #ffcc00;
      padding-bottom: 0.5rem;
    }

    .stop {
      background-color: #fffde6;
      margin-bottom: 2rem;
      padding: 1rem 1.5rem;
      border-left: 6px solid #ffcc00;
      border-right: 6px solid #ffcc00;
      border-top: 2px solid #ffd700;
      border-bottom: 2px solid #ffd700;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .stop h3 {
      margin-top: 0;
      color: #e6b800;
      border-bottom: 1px solid #ffeb99;
      padding-bottom: 0.25rem;
    }

    ul {
      list-style-type: none;
      padding-left: 0;
    }

    li {
      padding: 0.5rem 0;
      border-bottom: 1px solid #ffefb3;
    }

    li:last-child {
      border-bottom: none;
    }

    strong {
      color: #b38600;
    }
  </style>
<body>

  <div class="w3-bar w3-black w3-card w3-left-align w3-large">
    <a class="w3-bar-item w3-button w3-hide-medium w3-hide-large w3-right w3-padding-large w3-hover-white w3-large w3-yellow" href="javascript:void(0);" onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
    <a href="http://127.0.0.1:5000/" class="w3-bar-item w3-button w3-padding-large w3-white" style="height: 51px; overflow: visible;">
      <img src="{{ url_for('static', filename='thebus.png') }}" alt="Home" style="height: 40px; margin-top: -1px;">
    </a>
    <a href="http://127.0.0.1:5000/models" class="w3-bar-item w3-button w3-padding-large w3-white">Features</a>
    <a href="http://127.0.0.1:5000/about" class="w3-bar-item w3-button w3-padding-large w3-white">About</a>
    <a href="http://127.0.0.1:5000/contact" class="w3-bar-item w3-button w3-padding-large w3-white">Contact Us</a>
  </div>

  <h1>Closest Bus Stops Near You</h1>

  <div id="arrivalInfo"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const closestStops = JSON.parse(localStorage.getItem("closestStops"));

      if (!closestStops || closestStops.length === 0) {
        document.body.innerHTML = "<p>No nearby stops found.</p>";
        return;
      }

      const container = document.getElementById('arrivalInfo');
      closestStops.forEach(stop => {
        const stopId = stop.id;
        const distance = stop.distance.toFixed(2);

        const stopDiv = document.createElement('div');
        stopDiv.className = 'stop';
        stopDiv.innerHTML = `<h3>Stop ${stopId} (${distance} mi)</h3><ul id="arrivals-${stopId}"><li>Loading...</li></ul>`;
        container.appendChild(stopDiv);

        fetch(`/arrivals?stop=${stopId}`)
          .then(response => response.json())
          .then(data => {
            const ul = document.getElementById(`arrivals-${stopId}`);
            ul.innerHTML = '';  // clear "Loading..." text

            if (!data.arrivals || data.arrivals.length === 0) {
              ul.innerHTML = '<li>No upcoming arrivals</li>';
              return;
            }

            data.arrivals.forEach(arrival => {
              const vehicle = arrival.vehicle || 'Unknown';
              const route = arrival.route || 'Unknown route';
              const destination = arrival.headsign || 'Unknown destination';
              const arrivalTime = arrival.stopTime || 'Time unavailable';

              const li = document.createElement('li');
              li.innerHTML = `<strong>Vehicle:</strong> ${vehicle}, <strong>Route:</strong> ${route}, <strong>To:</strong> ${destination}, <strong>Arriving:</strong> ${arrivalTime}`;
              ul.appendChild(li);
            });

          })
          .catch(error => {
            console.error('Error fetching arrivals for stop:', stopId, error);
            const ul = document.getElementById(`arrivals-${stopId}`);
            ul.innerHTML = '<li>Error fetching data</li>';
          });
      });
    });
  </script>
</body>
</html>
